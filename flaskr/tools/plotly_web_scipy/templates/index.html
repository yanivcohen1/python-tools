<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PID Control System Simulation</title>
    <!-- Include Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<style>
    #pk {display:inline-block;margin-right:10px;}
    #pd {display:inline-block;margin-right:10px;}
    #pi {display:inline-block;margin-right:10px;}
    #pk_Val {display:inline-block;margin-right:10px;}
    #pd_Val {display:inline-block;margin-right:10px;}
    #pi_Val {display:inline-block;margin-right:10px;}
</style>
<body onload="submitData()">
    <h2>PID Control System Simulation</h2>
    <form id="dataForm">
        <label for="pk_values">Pk:</label>
        <input type="range" min="0" max="5" step="0.1" value="1.0" class="slider" id="pk" onmouseup="submitData()"
            ontouchend="submitData()" <p>Val: <span id="pk_val"></span></p>
        <label for="pd_values">Pd:</label>
        <input type="range" min="0" max="5" step="0.01" value="0.05" class="slider" id="pd" onmouseup="submitData()"
        ontouchend="submitData()" <p>Val: <span id="pd_val"></span></p>
        <label for="pi_values">Pi:</label>
        <input type="range" min="0" max="5" step="0.01" value="0.01" class="slider" id="pi" onmouseup="submitData()"
        ontouchend="submitData()" <p>Val: <span id="pi_val"></span></p>
        <button type="button" onclick="submitData()">Plot Data</button>
    </form>
    <p id="selected"></p>
    <div id="plot"></div>

    <script>

        document.getElementById('pk_val').innerHTML = document.getElementById('pk').value;
        document.getElementById('pd_val').innerHTML = document.getElementById('pd').value;
        document.getElementById('pi_val').innerHTML = Number(document.getElementById('pi').value);

        document.getElementById('pk').oninput = function() {
            document.getElementById('pk_val').innerHTML = this.value;
        }
        document.getElementById('pd').oninput = function() {
            document.getElementById('pd_val').innerHTML = this.value;
        }
        document.getElementById('pi').oninput = function() {
            document.getElementById('pi_val').innerHTML = Number(this.value);
        }

        function submitData() {
            var pk_val = document.getElementById('pk').value
            var pd_val = document.getElementById('pd').value
            var pi_val = Number(document.getElementById('pi').value)



            var data = {
                pk: pk_val,
                pd: pd_val,
                pi: pi_val
            };

            fetch('/plot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                var plotData = data <!-- JSON.parse(data); -->
                var config = {responsive: true}
                Plotly.newPlot('plot', plotData.data, plotData.layout, config);
                var myPlot = document.getElementById('plot')//,
                    // data = plotData.data,
                    // layout = plotData.layout
                myPlot.on('plotly_click', function(data){
                    txt = "<b>Selected:</b> " + data.points[0].data.name +
                        " <b>click on point:</b> " +
                        data.points[0].x+","+
                        data.points[0].y
                    document.getElementById('selected').innerHTML = txt
                    // alert( txt );
                    }
                )
            });
        }

    </script>
</body>
</html>
