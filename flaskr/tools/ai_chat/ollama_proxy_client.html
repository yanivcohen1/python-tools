<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama Chat</title>
</head>
<body>
    <h1>Ollama Chat Client</h1>
    <div id="chat"></div>
    <input id="input" placeholder="Type a message..." size="50" />
    <button onclick="sendMessage()">Send</button>

    <script>
        // Keep history as structured array
        let history = [];

        async function sendMessage() {
            const userMsg = document.getElementById('input').value;
            if (!userMsg) return;

            // Append to history
            history.push({ role: 'user', content: userMsg });

            // Send structured history to server
            const res = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messages: history })
            });
            const data = await res.json();
            const assistantReply = data.reply.trim();

            // Append assistant reply to history
            history.push({ role: 'assistant', content: assistantReply });

            // Display chat
            const chatDiv = document.getElementById('chat');
            const userDiv = document.createElement('div');
            userDiv.textContent = `You: ${userMsg}`;
            const botDiv = document.createElement('div');
            botDiv.textContent = `Assistant: ${assistantReply}`;
            chatDiv.appendChild(userDiv);
            chatDiv.appendChild(botDiv);

            document.getElementById('input').value = '';
        }
    </script>
</body>
</html>
